name: YouTube Automation

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install system libraries  
      run: |  
        sudo apt-get update  
        sudo apt-get install -y libjpeg-dev zlib1g-dev libfreetype6-dev  

    - name: Install dependencies
      run: |
        pip cache purge
        python -m pip install --upgrade pip==23.1.2
        pip install wheel
        pip install --no-cache-dir --force-reinstall -r requirements.txt
        pip list | grep -E "numpy|gtts|pillow"

    - name: Run YouTube Automation
      env:
        OPENAI_KEYS_JSON: ${{ secrets.OPENAI_KEYS }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        ELEVENLABS_API_KEY: ${{ secrets.ELEVENLABS_API_KEY }}
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        YOUTUBE_OAUTH_CREDENTIALS: ${{ secrets.YOUTUBE_OAUTH }}
      run: |
        cd src
        python main.py

# .github/workflows/main.yml
name: YouTube ìˆ˜ìµ ìë™í™” ë´‡ ğŸš€

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰

jobs:
  youtube-automation:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    steps:
    - name: ğŸ”„ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    - name: ğŸ Python 3.10 ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
    
    - name: ğŸ”§ ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        sudo apt-get update -y
        sudo apt-get install -y \
          libjpeg-dev \
          zlib1g-dev \
          libfreetype6-dev \
          ffmpeg \
          imagemagick \
          fonts-dejavu-core
        echo "âœ… ì‹œìŠ¤í…œ ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ"
    
    - name: ğŸ“¦ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
      run: |
        echo "ğŸ”„ pip ì—…ê·¸ë ˆì´ë“œ ì¤‘..."
        python -m pip install --upgrade pip
        
        echo "ğŸ”„ requirements.txt ì„¤ì¹˜ ì¤‘..."
        pip install -r requirements.txt
        
        echo "âœ… ëª¨ë“  íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ"
        
        echo "ğŸ” Google íŒ¨í‚¤ì§€ í™•ì¸ ì¤‘..."
        python -c "import google.generativeai; print('âœ… Google Generative AI ì •ìƒ ì„¤ì¹˜ë¨')"
        python -c "import google.auth; print('âœ… Google Auth ì •ìƒ ì„¤ì¹˜ë¨')"
        python -c "from googleapiclient.discovery import build; print('âœ… Google API Client ì •ìƒ ì„¤ì¹˜ë¨')"
    
    - name: ğŸš€ YouTube ìë™í™” ì‹¤í–‰
      env:
        OPENAI_KEYS_JSON: ${{ secrets.OPENAI_KEYS_JSON }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        ELEVENLABS_API_KEY: ${{ secrets.ELEVENLABS_API_KEY }}
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        YOUTUBE_OAUTH_CREDENTIALS: ${{ secrets.YOUTUBE_OAUTH_CREDENTIALS }}
        PYTHONPATH: ${{ github.workspace }}/src
      run: |
        echo "ğŸ¬ YouTube ìë™í™” ì‹œì‘..."
        cd ${{ github.workspace }}
        python src/main.py
    
    - name: ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ì—…ë¡œë“œ
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: automation-logs
        path: |
          *.log
          output/
          temp/
        retention-days: 3

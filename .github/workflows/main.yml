# .github/workflows/main.yml (μ „μ²΄ μ½”λ“)

name: YouTube Automation (μμµ μ°½μ¶ λ΄‡)

on:
  workflow_dispatch: # μλ™ μ‹¤ν–‰ κΈ°λ¥

jobs:
  build-and-upload:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'

    - name: Install System Dependencies for Pillow
      run: |
        sudo apt-get update
        sudo apt-get install -y libjpeg-dev zlib1g-dev libfreetype6-dev

    - name: Install Python Dependencies
      run: |
        set -e
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Verify No OpenCV Installation
      run: |
        echo "π« OpenCVκ°€ μ„¤μΉλμ§€ μ•μ•λ”μ§€ μµμΆ… ν™•μΈν•©λ‹λ‹¤..."
        # μ΄ λ‹¨κ³„κ°€ μ„±κ³µν•΄μ•Ό ν•©λ‹λ‹¤. (cv2 λ¨λ“μ΄ μ—†μ–΄μ•Ό ν•¨)
        if python -c "import cv2" 2>/dev/null; then
          echo "β μ‹¤ν¨: OpenCV(cv2)κ°€ μ„¤μΉλμ–΄ μμµλ‹λ‹¤! μ΄μ „ λ‹¨κ³„λ¥Ό ν™•μΈν•μ„Έμ”."
          exit 1
        else
          echo "β… μ„±κ³µ: μΆ‹μµλ‹λ‹¤! OpenCVκ°€ μ„¤μΉλμ§€ μ•μ•μµλ‹λ‹¤."
        fi

    - name: Run YouTube Automation Bot
      env:
        OPENAI_KEYS_JSON: ${{ secrets.OPENAI_KEYS_JSON }}
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        ELEVENLABS_API_KEY: ${{ secrets.ELEVENLABS_API_KEY }}
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        YOUTUBE_OAUTH_CREDENTIALS: ${{ secrets.YOUTUBE_OAUTH_CREDENTIALS }}
      run: |
        # src ν΄λ”λ΅ μ΄λ™ν•μ§€ μ•κ³  λ°”λ΅ μ‹¤ν–‰ν•μ—¬ κ²½λ΅ λ¬Έμ λ¥Ό μ—†μ•°
        python src/main.py
